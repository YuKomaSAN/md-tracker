# バグ調査報告書: GAS URL保存不具合について

## 1. 現象
公開ページでGAS URLを入力して「保存」を押しても、直後のデータ読み込みで「GAS URLが設定されていません」というエラーが表示される。

## 2. 原因

### 主な原因: グローバル変数の未更新
`saveUrl` 関数内で `localStorage` には値を保存していましたが、現在実行中のプログラムが参照しているグローバル変数 `GAS_URL` を更新していませんでした。
そのため、直後に呼び出される `loadData()` 関数が、古い（空の）`GAS_URL` を参照してしまいエラーになる。

**修正前:**
```javascript
function saveUrl() {
    localStorage.setItem('md_tracker_url', document.getElementById('gasUrlInput').value);
    // GAS_URL変数が更新されていない！
    loadData(); // -> 古いGAS_URLを見てエラーになる
}
```

### その他の発見されたバグ
調査中に以下のバグも発見されました。これらも合わせて修正します。

1.  **未定義変数 `doc` の参照エラー:**
    `loadData` 関数内で `doc.getElementById` を呼び出していますが、`doc` という変数は定義されていません（正しくは `document`）。これにより、データロード後にスクリプトが停止する可能性がありました。

2.  **デッキ選択の復元タイミング:**
    「前回使用したデッキ」を復元する処理が、データの受信完了（コールバック）を待たずに実行されていました。そのため、デッキリストが空の状態で判定が行われ、正しく復元されない場合がありました。

## 3. 修正内容
`script.js` に対して以下の修正を行います。

1.  `saveUrl` 関数で `GAS_URL` 変数を更新するように修正。
2.  デッキ復元処理をデータ受信完了後（コールバック内）に移動。
3.  `doc` を `document` に修正。
